# T√ÄI LI·ªÜU KI·∫æN TR√öC H·ªÜ TH·ªêNG

## DANANG TRAVEL-AI: H·ªá Th·ªëng L√™n L·ªãch Tr√¨nh Du L·ªãch Th√¥ng Minh

**Ng√¥n ng·ªØ t√†i li·ªáu:** Ti·∫øng Vi·ªát  
**Phi√™n b·∫£n:** 1.0  
**Ng√†y c·∫≠p nh·∫≠t:** 2025-12-06  
**M·ª•c ƒë√≠ch:** Cung c·∫•p t√†i li·ªáu ki·∫øn tr√∫c chu·∫©n ch·ªânh theo ti√™u chu·∫©n h·ªçc thu·∫≠t

---

## M·ª§C L·ª§C

1. [T·ªïng quan h·ªá th·ªëng](#1-t·ªïng-quan-h·ªá-th·ªëng)
2. [Ki·∫øn tr√∫c t·ªïng th·ªÉ](#2-ki·∫øn-tr√∫c-t·ªïng-th·ªÉ)
3. [Thi·∫øt k·∫ø d·ªØ li·ªáu](#3-thi·∫øt-k·∫ø-d·ªØ-li·ªáu)
4. [Ph√¢n t√≠ch ca s·ª≠ d·ª•ng](#4-ph√¢n-t√≠ch-ca-s·ª≠-d·ª•ng)
5. [Thi·∫øt k·∫ø chi ti·∫øt th√†nh ph·∫ßn](#5-thi·∫øt-k·∫ø-chi-ti·∫øt-th√†nh-ph·∫ßn)
6. [Lu·ªìng ho·∫°t ƒë·ªông ch√≠nh](#6-lu·ªìng-ho·∫°t-ƒë·ªông-ch√≠nh)
7. [C√¥ng ngh·ªá v√† stack](#7-c√¥ng-ngh·ªá-v√†-stack)
8. [C∆° ch·∫ø b·∫£o m·∫≠t](#8-c∆°-ch·∫ø-b·∫£o-m·∫≠t)

---

## 1. T·ªîNG QUAN H·ªÜ TH·ªêNG

### 1.1. M√¥ T·∫£ Chung

**DanangTravel-AI** l√† m·ªôt h·ªá th·ªëng qu·∫£n l√Ω l·ªãch tr√¨nh du l·ªãch th√¥ng minh d√†nh cho kh√°ch du l·ªãch ƒë·∫øn ƒê√† N·∫µng. H·ªá th·ªëng cung c·∫•p c√°c t√≠nh nƒÉng ch√≠nh:

- **T·∫°o l·ªãch tr√¨nh t·ª± ƒë·ªông:** L·∫≠p l·ªãch d·ª±a tr√™n ng√¢n s√°ch, th·ªùi gian, s·ªü th√≠ch, v√† r√†ng bu·ªôc (lo·∫°i v·∫≠n chuy·ªÉn, ch·ªó ·ªü)
- **G·ª£i √Ω ƒë·ªãa ƒëi·ªÉm th√¥ng minh:** S·ª≠ d·ª•ng AI ƒë·ªÉ ph√¢n t√≠ch d·ªØ li·ªáu ng∆∞·ªùi d√πng v√† g·ª£i √Ω ƒë·ªãa ƒëi·ªÉm ph√π h·ª£p
- **Qu·∫£n l√Ω 120+ ƒë·ªãa ƒëi·ªÉm:** C∆° s·ªü d·ªØ li·ªáu bao g·ªìm 30 nh√† ƒÉn, 50+ ƒëi·ªÉm tham quan, 20+ l∆∞u tr√∫, 10+ kh√°c
- **Chatbot t∆∞∆°ng t√°c:** Tr·ª£ l√Ω AI gi√∫p tr·∫£ l·ªùi c√¢u h·ªèi, ch·ªânh s·ª≠a l·ªãch, v√† t·ªëi ∆∞u h√≥a chi ph√≠
- **B·∫£ng ƒëi·ªÅu khi·ªÉn qu·∫£n tr·ªã:** C√¥ng c·ª• qu·∫£n l√Ω d·ªØ li·ªáu, l·ªãch s·ª≠ truy c·∫≠p, xu h∆∞·ªõng t√¨m ki·∫øm

### 1.2. M·ª•c Ti√™u Ki·∫øn Tr√∫c

1. **Scalability:** H·ªó tr·ª£ 1,000+ ng∆∞·ªùi d√πng ƒë·ªìng th·ªùi
2. **Maintainability:** M√£ ƒë∆∞·ª£c t·ªï ch·ª©c theo t·ª´ng t·∫ßng r√µ r√†ng
3. **Performance:** Th·ªùi gian ph·∫£n h·ªìi API < 2 gi√¢y
4. **Extensibility:** D·ªÖ m·ªü r·ªông t√≠nh nƒÉng m√† kh√¥ng ·∫£nh h∆∞·ªüng code hi·ªán t·∫°i
5. **Security:** B·∫£o v·ªá d·ªØ li·ªáu ng∆∞·ªùi d√πng, x√°c th·ª±c Admin, ph√¢n quy·ªÅn

### 1.3. Gi·∫£ ƒê·ªãnh Thi·∫øt K·∫ø

- Ng∆∞·ªùi d√πng ch·ªß y·∫øu truy c·∫≠p t·ª´ thi·∫øt b·ªã di ƒë·ªông v√† m√°y t√≠nh
- L∆∞u l∆∞·ª£ng cao v√†o c√°c gi·ªù: bu·ªïi t·ªëi (19h-22h), cu·ªëi tu·∫ßn
- D·ªØ li·ªáu l·ªãch s·ª≠ ƒë∆∞·ª£c gi·ªØ l·∫°i t·ªëi thi·ªÉu 1 nƒÉm

---

## 2. KI·∫æN TR√öC T·ªîNG TH·ªÇ

### 2.1. M√¥ H√¨nh Ki·∫øn Tr√∫c: Three-Tier + External Services

H·ªá th·ªëng ƒë∆∞·ª£c thi·∫øt k·∫ø theo m√¥ h√¨nh ba t·∫ßng (Three-Tier Architecture) v·ªõi t√≠ch h·ª£p d·ªãch v·ª• b√™n th·ª© ba:

```mermaid
graph TB
    subgraph Presentation["T·∫¶NG TR√åNH B√ÄY (Client)"]
        React["React 18 SPA<br/>- React Router v6<br/>- Tailwind CSS<br/>- Vite"]
    end

    subgraph Business["T·∫¶NG X·ª¨ L√ù LOGIC (Server)"]
        Express["Express.js API<br/>Port 3001"]
        Controllers["T·∫ßng Controller<br/>- L·ªãch Tr√¨nh<br/>- Chat<br/>- ƒê·ªãa ƒêi·ªÉm<br/>- Qu·∫£n Tr·ªã"]
        Services["T·∫ßng Service<br/>- T·∫°o L·ªãch Tr√¨nh<br/>- Chatbot<br/>- Qu·∫£n L√Ω ƒê·ªãa ƒêi·ªÉm<br/>- Qu·∫£n L√Ω Admin"]
        Middleware["Middleware<br/>- X√°c Th·ª±c<br/>- Ghi Nh·∫≠t K√Ω<br/>- X·ª≠ L√Ω L·ªói"]
    end

    subgraph Data["T·∫¶NG L∆ØU TR·ªÆ D·ªÆ LI·ªÜU"]
        DB["Prisma ORM<br/>SQLite (Ph√°t Tri·ªÉn) / PostgreSQL (S·∫£n Xu·∫•t)"]
    end

    subgraph External["EXTERNAL SERVICES"]
        Gemini["Google Gemini API<br/>NLP & LLM"]
        Maps["Google Maps API<br/>Geocoding & Distance"]
    end

    React -->|HTTP REST JSON| Express
    Express --> Controllers
    Controllers --> Services
    Services --> Middleware
    Services --> DB
    Services -.->|API Call| Gemini
    Services -.->|API Call| Maps
```

### 2.2. S∆° ƒê·ªì C4 Level 1: System Context

S∆° ƒë·ªì n√†y m√¥ t·∫£ c√°c t√°c nh√¢n b√™n ngo√†i v√† c√°ch h·ªç t∆∞∆°ng t√°c v·ªõi h·ªá th·ªëng, c√πng c√°c d·ªãch v·ª• ngo√†i m√† h·ªá th·ªëng ph·ª• thu·ªôc v√†o.

```mermaid
graph TB
    User["Kh√°ch Du L·ªãch<br/>(Tourist)"]
    Admin["Qu·∫£n Tr·ªã Vi√™n<br/>(Administrator)"]

    System["DanangTravel-AI<br/>H·ªá Th·ªëng L√™n L·ªãch Tr√¨nh<br/>Du L·ªãch Th√¥ng Minh"]

    Gemini["Google Gemini<br/>API"]
    Maps["Google Maps<br/>API"]

    User -->|Kh√°m ph√° ƒë·ªãa ƒëi·ªÉm<br/>T·∫°o l·ªãch tr√¨nh<br/>Chat t∆∞ v·∫•n| System
    Admin -->|Qu·∫£n l√Ω d·ªØ li·ªáu<br/>Xem th·ªëng k√™| System

    System -->|X·ª≠ l√Ω ng√¥n ng·ªØ t·ª± nhi√™n<br/>Tr·∫£ l·ªùi c√¢u h·ªèi| Gemini
    System -->|T√≠nh kho·∫£ng c√°ch<br/>X√°c th·ª±c v·ªã tr√≠| Maps
```

### 2.3. S∆° ƒê·ªì C4 Level 2: Container Diagram

```mermaid
graph TB
    subgraph Client["Client (M√°y Kh√°ch)"]
        Browser["Tr√¨nh Duy·ªát Web<br/>(Chrome, Firefox, Safari)"]
        SPA["·ª®ng D·ª•ng Web<br/>React + Vite<br/>- Trang Ch·ªß<br/>- K·∫øt Qu·∫£ L·ªãch Tr√¨nh<br/>- Chat AI<br/>- B·∫£ng ƒêi·ªÅu Khi·ªÉn Qu·∫£n Tr·ªã"]
        Storage["L∆∞u Tr·ªØ C·ª•c B·ªô<br/>D·ªØ Li·ªáu Phi√™n"]
    end

    subgraph Server["Server Backend"]
        API["Express.js API<br/>Port 3001"]
        Routes["T·∫ßng Route<br/>- /api/itinerary/*<br/>- /api/chat/*<br/>- /api/location/*<br/>- /api/admin/*"]
        Ctrls["T·∫ßng Controller<br/>- L·ªãchTr√¨nhController<br/>- ChatController<br/>- ƒê·ªãaƒêi·ªÉmController<br/>- Qu·∫£nTr·ªãController"]
        Srvs["T·∫ßng Service<br/>- T·∫°oL·ªãchTr√¨nh<br/>- ChatbotService<br/>- Qu·∫£nL√Ωƒê·ªãaƒêi·ªÉm<br/>- Qu·∫£nL√ΩAdmin"]
    end

    subgraph Data["T·∫ßng D·ªØ Li·ªáu"]
        DB["SQLite / PostgreSQL<br/>C∆° S·ªü D·ªØ Li·ªáu"]
        Prisma["Prisma ORM<br/>Schema & Migration"]
    end

    subgraph External["API B√™n Ngo√†i"]
        Gemini["Google Gemini<br/>X·ª≠ L√Ω NLP"]
        Maps["Google Maps<br/>T√≠nh Kho·∫£ng C√°ch"]
    end

    Browser -->|HTTP/HTTPS| SPA
    SPA -->|REST JSON| API
    SPA --> Storage

    API --> Routes
    Routes --> Ctrls
    Ctrls --> Srvs

    Srvs -->|Truy V·∫•n| Prisma
    Prisma --> DB

    Srvs -.->|G·ªçi API| Gemini
    Srvs -.->|G·ªçi API| Maps
```

---

### 2.4. S∆° ƒê·ªì Lu·ªìng D·ªØ Li·ªáu (DFD - Level 1)

S∆° ƒë·ªì lu·ªìng d·ªØ li·ªáu Level 1 th·ªÉ hi·ªán c√°ch d·ªØ li·ªáu chuy·ªÉn ƒë·ªông gi·ªØa c√°c qu√° tr√¨nh ch√≠nh, kho d·ªØ li·ªáu v√† c√°c t√°c nh√¢n ngo√†i h·ªá th·ªëng.

```mermaid
graph TB
    User["<b>Ng∆∞·ªùi D√πng/Admin</b><br/>(T√°c Nh√¢n Ngo√†i)"]
    Frontend["<b>·ª®ng D·ª•ng Web</b><br/>(React + Vite)<br/>- Hi·ªÉn th·ªã giao di·ªán<br/>- Thu th·∫≠p d·ªØ li·ªáu ng∆∞·ªùi d√πng<br/>- L∆∞u tr·ªØ phi√™n"]
    API["<b>API Backend</b><br/>(Express.js)<br/>- X·ª≠ l√Ω y√™u c·∫ßu<br/>- X√°c th·ª±c & ph√¢n quy·ªÅn<br/>- ƒêi·ªÅu ph·ªëi nghi·ªáp v·ª•"]
    Services["<b>T·∫ßng Service</b><br/>- T·∫°oL·ªãchTr√¨nh<br/>- ChatbotService<br/>- Qu·∫£nL√Ωƒê·ªãaƒêi·ªÉm<br/>- Qu·∫£nL√ΩAdmin"]
    Database["<b>Kho D·ªØ Li·ªáu</b><br/>(PostgreSQL/SQLite)<br/>- B·∫£ng: Admin<br/>- B·∫£ng: L·ªãch Tr√¨nh<br/>- B·∫£ng: ƒê·ªãa ƒêi·ªÉm<br/>- B·∫£ng: Nh·∫≠t K√Ω Chat"]
    LocalStorage["<b>L∆∞u Tr·ªØ C·ª•c B·ªô</b><br/>(Browser)<br/>- D·ªØ Li·ªáu Phi√™n<br/>- B·∫£n Nh√°p L·ªãch Tr√¨nh"]
    Gemini["<b>Google Gemini API</b><br/>- X·ª≠ L√Ω Ng√¥n Ng·ªØ T·ª± Nhi√™n<br/>- G·ª£i √ù & Tr·∫£ L·ªùi"]
    GoogleMaps["<b>Google Maps API</b><br/>- T√≠nh Kho·∫£ng C√°ch<br/>- Ch·ªâ ƒê∆∞·ªùng"]

    User -->|1. Nh·∫≠p D·ªØ Li·ªáu<br/>Y√™u C·∫ßu L·ªãch Tr√¨nh| Frontend
    Frontend -->|2. G·ª≠i Form JSON<br/>POST /api/itinerary| API
    API -->|3. X√°c Th·ª±c & Ph√¢n T√≠ch| Services
    Services -->|4. Truy V·∫•n D·ªØ Li·ªáu<br/>SELECT ƒê·ªãa ƒêi·ªÉm| Database
    Database -->|5. Tr·∫£ V·ªÅ Danh S√°ch<br/>ƒê·ªãa ƒêi·ªÉm & Nh√† H√†ng| Services
    Services -->|6a. G·ªçi API<br/>GET Kho·∫£ng C√°ch| GoogleMaps
    GoogleMaps -->|6b. Tr·∫£ V·ªÅ Ma Tr·∫≠n<br/>Kho·∫£ng C√°ch & Th·ªùi Gian| Services
    Services -->|7. T·∫°o L·ªãch Tr√¨nh<br/>Thu·∫≠t To√°n 7 Pha| Services
    Services -->|8. Tr·∫£ JSON<br/>L·ªãch Tr√¨nh Ho√†n Ch·ªânh| API
    API -->|9. G·ª≠i Ph·∫£n H·ªìi| Frontend
    Frontend -->|10. Hi·ªÉn Th·ªã K·∫øt Qu·∫£<br/>L∆∞u localStorage| LocalStorage
    User -->|11. M·ªü Chat| Frontend
    Frontend -->|12. G·ª≠i Tin Nh·∫Øn<br/>POST /api/chat/message| API
    API -->|13. Chuy·ªÉn Ti·∫øp| Services
    Services -->|14. G·ªçi API<br/>X·ª≠ L√Ω NLP| Gemini
    Gemini -->|15. Tr·∫£ V·ªÅ Ph·∫£n H·ªìi| Services
    Services -->|16. L∆∞u Log Chat<br/>INSERT| Database
    Database -->|17. X√°c Nh·∫≠n| Services
    Services -->|18. Tr·∫£ Ph·∫£n H·ªìi| API
    API -->|19. G·ª≠i Tin Nh·∫Øn| Frontend
    Frontend -->|20. Hi·ªÉn Th·ªã Chat| User
```

**Gi·∫£i th√≠ch quy tr√¨nh:**

| Pha                        | M√¥ T·∫£                                                                                   | D·ªØ Li·ªáu Chuy·ªÉn                                         |
| -------------------------- | --------------------------------------------------------------------------------------- | ------------------------------------------------------ |
| **T·∫°o L·ªãch Tr√¨nh (1-10)**  | Ng∆∞·ªùi d√πng nh·∫≠p y√™u c·∫ßu ‚Üí Frontend ‚Üí API ‚Üí Service ‚Üí Database ‚Üí T√≠nh To√°n ‚Üí Tr·∫£ K·∫øt Qu·∫£ | Form JSON, Danh s√°ch ƒë·ªãa ƒëi·ªÉm, L·ªãch tr√¨nh, Kho·∫£ng c√°ch |
| **T∆∞∆°ng T√°c Chat (11-20)** | Ng∆∞·ªùi d√πng g·ª≠i tin nh·∫Øn ‚Üí API ‚Üí Service ‚Üí Gemini ‚Üí L∆∞u Log ‚Üí Tr·∫£ Ph·∫£n H·ªìi               | Tin nh·∫Øn vƒÉn b·∫£n, Ph·∫£n h·ªìi AI, Log chat                |
| **L∆∞u Tr·ªØ**                | D·ªØ li·ªáu t·∫°m th·ªùi l∆∞u tr√™n m√°y kh√°ch, d·ªØ li·ªáu quan tr·ªçng l∆∞u DB                          | localStorage, PostgreSQL/SQLite                        |

---

## 3. THI·∫æT K·∫æ D·ªÆ LI·ªÜU

### 3.1. S∆° ƒê·ªì Entity-Relationship (ERD)

S∆° ƒë·ªì quan h·ªá th·ª±c th·ªÉ m√¥ t·∫£ c·∫•u tr√∫c c∆° s·ªü d·ªØ li·ªáu ho√†n ch·ªânh v·ªõi c√°c m·ªëi quan h·ªá t·ª´ng-m·ªôt (1-1), t·ª´ng-nhi·ªÅu (1-N) v√† nhi·ªÅu-nhi·ªÅu (N-N) gi·ªØa c√°c b·∫£ng.

```mermaid
erDiagram
    ADMIN {
        uuid id PK
        string username UK
        string passwordHash
        string email
        string role
        boolean active
        datetime createdAt
    }

    LOCATION {
        uuid id PK
        string name
        string address
        decimal lat
        decimal lng
        string type
        string visitType
        decimal ticket
        decimal food
        decimal extra
        string priceLevel
        json tags
        text description
        string bestTime
        json operatingHours
        int suggestedDuration
    }

    KNOWLEDGE {
        uuid id PK
        string question
        string answer
        json keywords
        string patternType
        boolean active
    }

    TRANSPORT {
        uuid id PK
        string name
        string type
        decimal basePrice
        decimal pricePerKm
    }

    ACCESS_LOG {
        uuid id PK
        string ip
        string endpoint
        string method
        string username FK
        int statusCode
        datetime createdAt
    }

    CHAT_LOG {
        uuid id PK
        uuid sessionId
        text userMessage
        text botResponse
        string intent
        decimal confidence
        datetime createdAt
    }

    SEARCH_TREND {
        uuid id PK
        string keyword
        int count
        datetime weekStart
    }

    ITINERARY {
        uuid id PK
        string name
        datetime startDate
        datetime endDate
        decimal totalBudget
        decimal totalCost
        json preferences
        datetime createdAt
    }

    ADMIN ||--o{ KNOWLEDGE : qu·∫£n_l√Ω
    ADMIN ||--o{ LOCATION : ch·ªânh_s·ª≠a
    ADMIN ||--o{ ACCESS_LOG : t·∫°o_ra
    LOCATION ||--o{ CHAT_LOG : ƒë∆∞·ª£c_ƒë·ªÅ_c·∫≠p
    ITINERARY ||--o{ LOCATION : ch·ª©a_c√°c
```

M·ªëi quan h·ªá chi ti·∫øt:

- **ADMIN - KNOWLEDGE** (1-N): M·ªôt qu·∫£n tr·ªã vi√™n qu·∫£n l√Ω nhi·ªÅu m·∫´u Q&A cho chatbot
- **ADMIN - LOCATION** (1-N): M·ªôt qu·∫£n tr·ªã vi√™n c√≥ th·ªÉ ch·ªânh s·ª≠a nhi·ªÅu ƒë·ªãa ƒëi·ªÉm
- **ADMIN - ACCESS_LOG** (1-N): M·ªói b·∫£n ghi l·ªãch s·ª≠ truy c·∫≠p li√™n k·∫øt v·ªõi m·ªôt admin
- **LOCATION - CHAT_LOG** (1-N): M·ªôt ƒë·ªãa ƒëi·ªÉm c√≥ th·ªÉ ƒë∆∞·ª£c ƒë·ªÅ c·∫≠p nhi·ªÅu l·∫ßn trong c√°c cu·ªôc tr√≤ chuy·ªán
- **ITINERARY - LOCATION** (N-N): M·ªôt l·ªãch tr√¨nh ch·ª©a nhi·ªÅu ƒë·ªãa ƒëi·ªÉm, m·ªôt ƒë·ªãa ƒëi·ªÉm c√≥ th·ªÉ xu·∫•t hi·ªán trong nhi·ªÅu l·ªãch tr√¨nh

### 3.2. S∆° ƒê·ªì Tr·∫°ng Th√°i ƒê·ªãa ƒêi·ªÉm (Entity State Diagram - Location)

S∆° ƒë·ªì n√†y th·ªÉ hi·ªán c√°c tr·∫°ng th√°i kh√°c nhau c·ªßa m·ªôt ƒë·ªãa ƒëi·ªÉm trong v√≤ng ƒë·ªùi c·ªßa n√≥ v√† c√°c chuy·ªÉn ƒë·ªïi gi·ªØa c√°c tr·∫°ng th√°i.

```mermaid
stateDiagram-v2
    [*] --> Ch∆∞aKichHo·∫°t: Admin t·∫°o ƒë·ªãa ƒëi·ªÉm m·ªõi

    Ch∆∞aKichHo·∫°t --> KichHo·∫°t: Admin b·∫≠t ƒë·ªãa ƒëi·ªÉm<br/>(active = true)
    Ch∆∞aKichHo·∫°t --> X√≥aM·ªÅm: Admin xo√° ƒë·ªãa ƒëi·ªÉm<br/>(x√≥a logic)

    KichHo·∫°t --> Ch·ªânhS·ª≠a: Admin c·∫≠p nh·∫≠t th√¥ng tin<br/>(t√™n, gi√°, gi·ªù m·ªü c·ª≠a)
    KichHo·∫°t --> TamD·ª´ng: ƒê·ªãa ƒëi·ªÉm ƒë√≥ng c·ª≠a t·∫°m th·ªùi<br/>(b·∫£o tr√¨, s·ª± ki·ªán)
    KichHo·∫°t --> X√≥aM·ªÅm: Admin xo√° ƒë·ªãa ƒëi·ªÉm<br/>(x√≥a logic)

    Ch·ªânhS·ª≠a --> KichHo·∫°t: Ho√†n th√†nh ch·ªânh s·ª≠a
    Ch·ªânhS·ª≠a --> X√≥aM·ªÅm: H·ªßy & xo√°

    TamD·ª´ng --> KichHo·∫°t: ƒê·ªãa ƒëi·ªÉm ho·∫°t ƒë·ªông tr·ªü l·∫°i
    TamD·ª´ng --> X√≥aM·ªÅm: Quy·∫øt ƒë·ªãnh xo√° vƒ©nh vi·ªÖn (logic)

    X√≥aM·ªÅm --> [*]: D·ªØ li·ªáu v·∫´n l∆∞u trong DB<br/>(deleted_at != null)

    note right of KichHo·∫°t
        Tr·∫°ng th√°i ch√≠nh
        - Hi·ªÉn th·ªã trong danh s√°ch
        - C√≥ th·ªÉ th√™m v√†o l·ªãch tr√¨nh
        - C√≥ th·ªÉ chat v·ªÅ ƒë·ªãa ƒëi·ªÉm n√†y
    end note

    note right of Ch·ªânhS·ª≠a
        Tr·∫°ng th√°i t·∫°m th·ªùi
        Admin ƒëang c·∫≠p nh·∫≠t:
        - T√™n, ƒë·ªãa ch·ªâ, t·ªça ƒë·ªô
        - Gi√° v√©, ƒÉn, chi ph√≠ kh√°c
        - Gi·ªù m·ªü c·ª≠a, m√¥ t·∫£
    end note

    note right of TamD·ª´ng
        Tr·∫°ng th√°i t·∫°m d·ª´ng
        - V·∫´n hi·ªÉn th·ªã (v·ªõi d·∫•u‚ö†Ô∏è)
        - Kh√¥ng th√™m v√†o l·ªãch m·ªõi
        - Th√¥ng b√°o "ƒê√≥ng c·ª≠a t·∫°m th·ªùi"
    end note

    note right of X√≥aM·ªÅm
        Soft Delete (x√≥a logic)
        - Kh√¥ng hi·ªÉn th·ªã trong UI
        - D·ªØ li·ªáu v·∫´n ·ªü DB
        - C√≥ th·ªÉ kh√¥i ph·ª•c
        - deleted_at ƒë∆∞·ª£c ghi l·∫°i
    end note
```

**B·∫£ng chuy·ªÉn ƒë·ªïi tr·∫°ng th√°i chi ti·∫øt:**

| Tr·∫°ng Th√°i Hi·ªán T·∫°i | S·ª± Ki·ªán                 | Tr·∫°ng Th√°i Ti·∫øp Theo | ƒêi·ªÅu Ki·ªán        | Ghi Ch√∫                   |
| ------------------- | ----------------------- | -------------------- | ---------------- | ------------------------- |
| Ch∆∞aKichHo·∫°t        | Admin b·∫≠t (active=true) | KichHo·∫°t             | -                | ƒê·ªãa ƒëi·ªÉm s·∫µn s√†ng s·ª≠ d·ª•ng |
| KichHo·∫°t            | Admin ch·ªânh s·ª≠a         | Ch·ªânhS·ª≠a             | -                | ƒêang c·∫≠p nh·∫≠t th√¥ng tin   |
| Ch·ªânhS·ª≠a            | L∆∞u ho√†n th√†nh          | KichHo·∫°t             | Data h·ª£p l·ªá      | Quay v·ªÅ tr·∫°ng th√°i ch√≠nh  |
| KichHo·∫°t            | T·∫°m d·ª´ng ho·∫°t ƒë·ªông      | TamD·ª´ng              | C√≥ l√Ω do         | S·∫Ω quay l·∫°i               |
| TamD·ª´ng             | Quay l·∫°i ho·∫°t ƒë·ªông      | KichHo·∫°t             | -                | X√°c nh·∫≠n kh√¥ng c√≤n s·ª± c·ªë  |
| B·∫•t K·ª≥              | Xo√° logic               | X√≥aM·ªÅm               | Quy·∫øt ƒë·ªãnh Admin | deleted_at ƒë∆∞·ª£c ghi l·∫°i   |
| X√≥aM·ªÅm              | Kh√¥i ph·ª•c               | Tr·∫°ng th√°i c≈©        | Admin y√™u c·∫ßu    | deleted_at = null         |

### 3.3. Th√¥ng S·ªë D·ªØ Li·ªáu

| B·∫£ng         | S·ªë b·∫£n ghi | Ghi ch√∫                                                          |
| ------------ | ---------- | ---------------------------------------------------------------- |
| LOCATION     | 120+       | Ph√¢n chia chi ti·∫øt: 30 nh√† ƒÉn, 50+ ƒëi·ªÉm tham quan, 20+ kh√°ch s·∫°n |
| ADMIN        | 1-5        | T√†i kho·∫£n qu·∫£n tr·ªã                                               |
| KNOWLEDGE    | 50-100     | M·∫´u Q&A cho chatbot                                              |
| TRANSPORT    | 6-8        | C√°c ph∆∞∆°ng ti·ªán di chuy·ªÉn (taxi, grab, xe ri√™ng...)              |
| ACCESS_LOG   | 1M+/nƒÉm    | D·ªØ li·ªáu th·ªëng k√™ (‚âà100 requests/ng√†y √ó 365)                      |
| CHAT_LOG     | 100K+/nƒÉm  | L·ªãch s·ª≠ t∆∞∆°ng t√°c ng∆∞·ªùi d√πng                                     |
| SEARCH_TREND | 10K+/nƒÉm   | Xu h∆∞·ªõng t√¨m ki·∫øm theo tu·∫ßn                                      |

### 3.3. Chu·∫©n H√≥a D·ªØ Li·ªáu

- **M·ª©c chu·∫©n h√≥a:** 3NF (Third Normal Form)
- **Kh√¥ng d∆∞ th·ª´a:** M·ªói d·ªØ li·ªáu l∆∞u m·ªôt l·∫ßn duy nh·∫•t
- **R√†ng bu·ªôc to√†n v·∫πn:** Foreign Keys khai b√°o r√µ r√†ng
- **Hi·ªáu su·∫•t:** Indexed tr√™n: `username`, `type`, `area`, `createdAt`

---

## 4. PH√ÇN T√çCH CA S·ª¨ D·ª§NG

### 4.1. C√°c T√°c Nh√¢n (Actors)

| T√°c Nh√¢n          | Vai Tr√≤            | Quy·ªÅn H·∫°n                                     |
| ----------------- | ------------------ | --------------------------------------------- |
| **Kh√°ch Du L·ªãch** | Ng∆∞·ªùi d√πng cu·ªëi    | Xem ƒë·ªãa ƒëi·ªÉm, t·∫°o l·ªãch tr√¨nh, chat v·ªõi AI     |
| **Qu·∫£n Tr·ªã Vi√™n** | Qu·∫£n l√Ω h·ªá th·ªëng   | CRUD d·ªØ li·ªáu, xem th·ªëng k√™, c·∫•u h√¨nh h·ªá th·ªëng |
| **Google Gemini** | D·ªãch v·ª• b√™n th·ª© ba | X·ª≠ l√Ω NLP, t·∫°o ph·∫£n h·ªìi th√¥ng minh            |
| **Google Maps**   | D·ªãch v·ª• b√™n th·ª© ba | T√≠nh kho·∫£ng c√°ch, x√°c th·ª±c v·ªã tr√≠             |

### 4.1.1. Ghi Ch√∫ Quan Tr·ªçng: Ch·∫ø ƒê·ªô X√°c Th·ª±c Hi·ªán T·∫°i

**Kh√°ch Du L·ªãch (User Th∆∞·ªùng):**

- **Hi·ªán t·∫°i**: Kh√¥ng c·∫ßn ƒëƒÉng nh·∫≠p, truy c·∫≠p **Anonymous** (·∫®n danh)
- **C√°ch ho·∫°t ƒë·ªông**:
  - Kh√°ch v√†o web ‚Üí Xem ƒë·ªãa ƒëi·ªÉm ngay l·∫≠p t·ª©c
  - T·∫°o l·ªãch tr√¨nh kh√¥ng c·∫ßn t√†i kho·∫£n
  - L·ªãch tr√¨nh ƒë∆∞·ª£c l∆∞u **t·∫°m th·ªùi trong localStorage** c·ªßa tr√¨nh duy·ªát
  - Khi t·∫Øt tr√¨nh duy·ªát ‚Üí D·ªØ li·ªáu m·∫•t (ho·∫∑c ƒë∆∞·ª£c ghi nh·ªõ n·∫øu b·∫≠t LocalStorage)
- **Schema**: Kh√¥ng c√≥ b·∫£ng `User` trong database
- **Tracking**: AccessLog v·∫´n ghi nh·∫≠n h√†nh ƒë·ªông nh∆∞ng `username = null` v√† `role = null`

**Qu·∫£n Tr·ªã Vi√™n (Admin):**

- **C·∫ßn ƒëƒÉng nh·∫≠p**: Username + Password
- **C√°ch ho·∫°t ƒë·ªông**:
  - Truy c·∫≠p `/api/admin/login`
  - X√°c th·ª±c trong b·∫£ng `Admin` (schema.prisma)
  - Nh·∫≠n session token (HttpOnly Cookie)
  - C√≥ th·ªÉ CRUD d·ªØ li·ªáu, xem th·ªëng k√™
- **Middleware**: `adminAuth.middleware.js` b·∫£o v·ªá routes `/api/admin/*`

**√ù Nghƒ©a Thi·∫øt K·∫ø:**

- **ƒê∆°n gi·∫£n ho√° UX**: Kh√°ch kh√¥ng c·∫ßn ƒëƒÉng k√Ω, v√†o l√† s·ª≠ d·ª•ng ngay
- **Phase 2 (T∆∞∆°ng Lai)**: C√≥ th·ªÉ th√™m User Authentication ƒë·ªÉ l∆∞u l·ªãch tr√¨nh c√° nh√¢n
- **Hi·ªán t·∫°i t·∫≠p trung v√†o**: Admin qu·∫£n l√Ω d·ªØ li·ªáu, kh√°ch d√πng mi·ªÖn ph√≠

### 4.2. Danh S√°ch Ca S·ª≠ D·ª•ng

H·ªá th·ªëng cung c·∫•p 7 ca s·ª≠ d·ª•ng ch√≠nh d√†nh cho hai lo·∫°i t√°c nh√¢n: kh√°ch du l·ªãch (·∫©n danh) v√† qu·∫£n tr·ªã vi√™n (y√™u c·∫ßu ƒëƒÉng nh·∫≠p).

```mermaid
graph TB
    User["Kh√°ch Du L·ªãch<br/>(Anonymous - Kh√¥ng c·∫ßn Login)"]
    Admin["Qu·∫£n Tr·ªã Vi√™n<br/>(C·∫ßn ƒêƒÉng Nh·∫≠p)"]

    UC1["UC-01: Kh√°m Ph√° ƒê·ªãa ƒêi·ªÉm"]
    UC2["UC-02: T·∫°o L·ªãch Tr√¨nh T·ª± ƒê·ªông"]
    UC3["UC-03: Ch·ªânh S·ª≠a L·ªãch"]
    UC4["UC-04: Chat T∆∞ V·∫•n"]
    UC5["UC-05: Qu·∫£n L√Ω ƒê·ªãa ƒêi·ªÉm"]
    UC6["UC-06: Xem Th·ªëng K√™"]
    UC7["UC-07: Qu·∫£n L√Ω M·∫´u AI"]

    User -->|S·ª≠ D·ª•ng| UC1
    User -->|S·ª≠ D·ª•ng| UC2
    User -->|S·ª≠ D·ª•ng| UC3
    User -->|S·ª≠ D·ª•ng| UC4

    Admin -->|S·ª≠ D·ª•ng| UC5
    Admin -->|S·ª≠ D·ª•ng| UC6
    Admin -->|S·ª≠ D·ª•ng| UC7
```

B·∫£ng m√¥ t·∫£ chi ti·∫øt:

| ID    | T√™n Ca S·ª≠ D·ª•ng         | T√°c Nh√¢n      | Lo·∫°i      | M√¥ T·∫£                                                                                    |
| ----- | ---------------------- | ------------- | --------- | ---------------------------------------------------------------------------------------- |
| UC-01 | Kh√°m ph√° ƒë·ªãa ƒëi·ªÉm      | Kh√°ch du l·ªãch | Ch√≠nh     | Xem danh s√°ch c√°c ƒë·ªãa ƒëi·ªÉm trong ƒê√† N·∫µng, t√¨m ki·∫øm theo t√™n, l·ªçc theo lo·∫°i ho·∫∑c gi√° ti·ªÅn |
| UC-02 | T·∫°o l·ªãch tr√¨nh t·ª± ƒë·ªông | Kh√°ch du l·ªãch | **Ch√≠nh** | T·∫°o l·ªãch tr√¨nh ho√†n ch·ªânh t·ª´ y√™u c·∫ßu v·ªÅ ng√¢n s√°ch, ng√†y th√°ng, s·ªü th√≠ch                  |
| UC-03 | Ch·ªânh s·ª≠a l·ªãch         | Kh√°ch du l·ªãch | Ph·ª•       | Thay th·∫ø ho·∫∑c x√≥a c√°c ho·∫°t ƒë·ªông trong l·ªãch tr√¨nh ƒë√£ t·∫°o                                  |
| UC-04 | Chat v·ªõi AI t∆∞ v·∫•n     | Kh√°ch du l·ªãch | Ph·ª•       | Tr√≤ chuy·ªán ƒë·ªÉ t·ªëi ∆∞u l·ªãch, h·ªèi ƒë√°p v·ªÅ ƒë·ªãa ƒëi·ªÉm, thay ƒë·ªïi l·ªãch theo g·ª£i √Ω                 |
| UC-05 | Qu·∫£n l√Ω ƒë·ªãa ƒëi·ªÉm       | Qu·∫£n tr·ªã vi√™n | **Ch√≠nh** | Th√™m, s·ª≠a, x√≥a th√¥ng tin ƒë·ªãa ƒëi·ªÉm, c·∫≠p nh·∫≠t gi√° v√© v√† gi·ªù ho·∫°t ƒë·ªông                      |
| UC-06 | Xem th·ªëng k√™ h·ªá th·ªëng  | Qu·∫£n tr·ªã vi√™n | Ph·ª•       | Xem l·ªãch s·ª≠ truy c·∫≠p, xu h∆∞·ªõng t√¨m ki·∫øm, s·ªë l∆∞·ª£t d√πng c√°c t√≠nh nƒÉng                      |
| UC-07 | Qu·∫£n l√Ω m·∫´u tr·∫£ l·ªùi AI | Qu·∫£n tr·ªã vi√™n | **Ch√≠nh** | Th√™m ho·∫∑c ch·ªânh s·ª≠a c√°c m·∫´u c√¢u h·ªèi-tr·∫£ l·ªùi ƒë·ªÉ hu·∫•n luy·ªán chatbot                        |

### 4.3. Chi Ti·∫øt UC-02: Generate Itinerary

ƒê√¢y l√† ca s·ª≠ d·ª•ng ch√≠nh c·ªßa h·ªá th·ªëng, n∆°i kh√°ch du l·ªãch cung c·∫•p y√™u c·∫ßu v√† nh·∫≠n l·∫°i l·ªãch tr√¨nh ho√†n ch·ªânh. Quy tr√¨nh bao g·ªìm x√°c th·ª±c d·ªØ li·ªáu, ph√¢n b·ªï ng√¢n s√°ch, ch·ªçn l∆∞u tr√∫, v√† l·∫≠p l·ªãch chi ti·∫øt cho t·ª´ng ng√†y.

**Quy Tr√¨nh T·∫°o L·ªãch Tr√¨nh:**

```mermaid
graph TD
    A["Nh·∫≠n d·ªØ li·ªáu t·ª´ ng∆∞·ªùi d√πng<br/>Ng√¢n s√°ch, Ng√†y th√°ng, S·ªü th√≠ch"]
    B{"D·ªØ li·ªáu<br/>h·ª£p l·ªá?"}
    C["Ki·ªÉm tra ng√¢n s√°ch t·ªëi thi·ªÉu<br/>300.000 VND/ng∆∞·ªùi/ng√†y"]
    D{"Ng√¢n s√°ch<br/>ƒë·ªß?"}
    E["Th√¥ng b√°o l·ªói<br/>G·ª£i √Ω tƒÉng ng√¢n s√°ch"]
    F["Ch·ªçn kh√°ch s·∫°n<br/>ph√π h·ª£p lo·∫°i l∆∞u tr√∫"]
    G["Ph√¢n b·ªï ng√¢n s√°ch<br/>cho t·ª´ng ng√†y"]
    H["L·∫•y danh s√°ch<br/>t·∫•t c·∫£ ƒë·ªãa ƒëi·ªÉm"]

    I["L·∫≠p l·ªãch ng√†y 1"]
    J["X·ª≠ l√Ω 7 pha t·ª´ s√°ng ƒë·∫øn t·ªëi<br/>ƒÇn s√°ng ‚Üí Tham quan ‚Üí ƒÇn tr∆∞a ‚Üí Tham quan ‚Üí ƒÇn t·ªëi ‚Üí Vui ch∆°i ‚Üí V·ªÅ l∆∞u tr√∫"]
    K["L·∫≠p l·ªãch ng√†y 2"]
    L["L·∫≠p l·ªãch ng√†y 3"]

    M["ƒê·ªãnh d·∫°ng k·∫øt qu·∫£<br/>JSON response"]
    N["Tr·∫£ v·ªÅ l·ªãch tr√¨nh<br/>HTTP 200 OK"]

    A --> B
    B -->|Kh√¥ng| E
    E --> A
    B -->|C√≥| C
    C --> D
    D -->|Kh√¥ng| E
    D -->|C√≥| F
    F --> G
    G --> H
    H --> I
    I --> J
    J --> K
    K --> J
    J --> L
    L --> M
    M --> N
```

---

## 5. THI·∫æT K·∫æ CHI TI·∫æT TH√ÄNH PH·∫¶N

### 5.1. T·∫ßng Frontend (Presentation Layer)

**T·ªï ch·ª©c Th∆∞ M·ª•c:**

```
Frontend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/       # Reusable UI
‚îÇ   ‚îú‚îÄ‚îÄ pages/           # Page components
‚îÇ   ‚îú‚îÄ‚îÄ features/        # Feature modules
‚îÇ   ‚îú‚îÄ‚îÄ services/        # API client
‚îÇ   ‚îú‚îÄ‚îÄ utils/           # Helper functions
‚îÇ   ‚îî‚îÄ‚îÄ styles/          # Tailwind CSS
‚îú‚îÄ‚îÄ public/              # Static assets
‚îú‚îÄ‚îÄ vite.config.js
‚îî‚îÄ‚îÄ tailwind.config.js
```

**S∆° ƒë·ªì Component Structure:**

```mermaid
graph TB
    subgraph Frontend["Frontend - React SPA"]
        App["App.jsx<br/>Nh√† Cung C·∫•p Router"]

        subgraph Pages["T·∫ßng Pages"]
            Home["Trang Ch·ªß<br/>Form Nh·∫≠p Li·ªáu"]
            Results["Trang K·∫øt Qu·∫£ L·ªãch Tr√¨nh<br/>Hi·ªÉn Th·ªã & Ch·ªânh S·ª≠a"]
            Chat["Trang Chat<br/>Giao Di·ªán Bot"]
            Admin["Trang B·∫£ng ƒêi·ªÅu Khi·ªÉn<br/>Qu·∫£n L√Ω"]
        end

        subgraph Components["T·∫ßng Components"]
            Header["Header<br/>ƒêi·ªÅu H∆∞·ªõng"]
            Footer["Footer"]
            Loading["Bi·ªÉu T∆∞·ª£ng T·∫£i"]
            ErrorBound["B·∫Øt L·ªói"]
            Messages["Tin Nh·∫Øn Chat"]
            Cards["Th·∫ª & Danh S√°ch"]
        end

        subgraph Services["T·∫ßng Services"]
            APIService["api.service.js<br/>Kh√°ch H√†ng REST"]
            StorageService["storage.service.js<br/>L∆∞u Tr·ªØ C·ª•c B·ªô"]
        end

        subgraph Utils["Ti·ªán √çch & Ki·ªÉu D√°ng"]
            Format["format.utils.js"]
            CSS["main.css<br/>Tailwind"]
        end
    end

    App --> Pages
    App --> Components
    Pages --> Services
    Components --> Services
    Services --> Utils
```

**Stack C√¥ng Ngh·ªá:**

- React 18.x + React Hooks
- Vite 5.x (Build tool)
- React Router v6 (Navigation)
- Tailwind CSS (Styling)
- Fetch API (HTTP client)

**C√°c Trang Ch√≠nh:**

- HomePage: Bi·ªÉu m·∫´u nh·∫≠p li·ªáu
- ItineraryResultsPage: Hi·ªÉn th·ªã l·ªãch tr√¨nh chi ti·∫øt
- ChatPage: Giao di·ªán chatbot t∆∞∆°ng t√°c
- AdminDashboardPage: B·∫£ng ƒëi·ªÅu khi·ªÉn qu·∫£n tr·ªã

### 5.2. T·∫ßng Backend (Business Logic Layer)

**T·ªï ch·ª©c Th∆∞ M·ª•c:**

```
Backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ routes/          # API endpoints
‚îÇ   ‚îú‚îÄ‚îÄ controllers/     # Request handlers
‚îÇ   ‚îú‚îÄ‚îÄ services/        # Business logic
‚îÇ   ‚îú‚îÄ‚îÄ middleware/      # Middleware functions
‚îÇ   ‚îú‚îÄ‚îÄ utils/           # Helper functions
‚îÇ   ‚îú‚îÄ‚îÄ adapters/        # External APIs
‚îÇ   ‚îî‚îÄ‚îÄ config/          # Constants
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îú‚îÄ‚îÄ schema.prisma    # DB schema
‚îÇ   ‚îú‚îÄ‚îÄ seed.js          # Seed script
‚îÇ   ‚îî‚îÄ‚îÄ migrations/      # DB migrations
‚îî‚îÄ‚îÄ scripts/             # Utility scripts
```

**S∆° ƒë·ªì Service Architecture:**

```mermaid
graph TB
    subgraph Backend["Backend - Server Express.js"]
        subgraph Routes["T·∫ßng Route"]
            RItinerary["routes/itinerary.routes.js<br/>POST /generate"]
            RChat["routes/chat.routes.js<br/>POST /message"]
            RLocation["routes/location.routes.js<br/>GET /"]
            RAdmin["routes/admin.routes.js<br/>GET/POST/PUT/DELETE"]
        end

        subgraph Controllers["T·∫ßng Controller"]
            CItinerary["ItineraryController<br/>- X√°c Th·ª±c Input<br/>- G·ªçi Service"]
            CChat["ChatController"]
            CLocation["LocationController"]
            CAdmin["AdminController"]
        end

        subgraph Services["T·∫ßng Service - LOGIC CH√çNH"]
            SItinerary["ItineraryService<br/>- T·∫°o L·ªãch Tr√¨nh<br/>- T·∫°o L·ªãch T·ª´ng Ng√†y"]
            SChat["ChatbotService<br/>- X·ª≠ L√Ω Tin Nh·∫Øn Chat<br/>- G·ªçi Gemini API"]
            SLocation["LocationService<br/>- T√¨m Ki·∫øm ƒê·ªãa ƒêi·ªÉm"]
            SAdmin["AdminService<br/>- X√°c Th·ª±c Admin"]
        end

        subgraph Utils["Ti·ªán √çch & X√°c Th·ª±c"]
            Validator["itinerary-validator.js<br/>- L·ªçc ƒê·ªãa ƒêi·ªÉm H·ª£p L·ªá<br/>- X√°c Th·ª±c Ng√¢n S√°ch"]
            DaySchedule["generate-day-schedule-strict.js<br/>- Logic 7 Giai ƒêo·∫°n"]
            Constants["scheduling.constants.js<br/>- LOCATION_RULES"]
            Helpers["itinerary-helpers.js<br/>- T√≠nh Kho·∫£ng C√°ch"]
        end

        subgraph Data["T·∫ßng D·ªØ Li·ªáu"]
            ORM["Prisma ORM"]
            DB["SQLite/PostgreSQL"]
        end
    end

    RItinerary --> CItinerary
    RChat --> CChat
    RLocation --> CLocation
    RAdmin --> CAdmin

    CItinerary --> SItinerary
    CChat --> SChat
    CLocation --> SLocation
    CAdmin --> SAdmin

    SItinerary --> Validator
    SItinerary --> DaySchedule
    DaySchedule --> Constants
    SItinerary --> Helpers

    Services --> ORM
    ORM --> DB
```

**Stack C√¥ng Ngh·ªá:**

- Node.js 18+
- Express.js 4.x
- Prisma 5.x (ORM)
- SQLite (ph√°t tri·ªÉn) / PostgreSQL (s·∫£n xu·∫•t)
- Google Gemini API
- Google Maps API
- npm 10.x

---

### 5.3. Chi Ti·∫øt L·ªõp ƒê·ªãnh Tuy·∫øn v√† ƒêi·ªÅu Khi·ªÉn (Routing & Controller Layer)

L·ªõp Route + Controller ch·ªãu tr√°ch nhi·ªám nh·∫≠n y√™u c·∫ßu HTTP, x√°c th·ª±c d·ªØ li·ªáu ban ƒë·∫ßu, v√† chuy·ªÉn ti·∫øp ƒë·∫øn Service layer.

```mermaid
graph TB
    subgraph Routes["Routes Layer - ƒê·ªãnh Tuy·∫øn"]
        R1["itinerary.routes.js<br/>POST /api/itinerary/generate<br/>GET /api/itinerary/history<br/>PUT /api/itinerary/:id<br/>DELETE /api/itinerary/:id"]
        R2["chat.routes.js<br/>POST /api/chat/message<br/>GET /api/chat/history<br/>DELETE /api/chat/session"]
        R3["location.routes.js<br/>GET /api/location<br/>GET /api/location/:id<br/>GET /api/location/search"]
        R4["admin.routes.js<br/>POST /api/admin/login<br/>GET /api/admin/dashboard<br/>PUT /api/admin/location/:id<br/>POST /api/admin/knowledge"]
    end

    subgraph Controllers["Controllers Layer - ƒêi·ªÅu Khi·ªÉn"]
        C1["ItineraryController<br/>generateItinerary(req, res)<br/>- Parse JSON payload<br/>- Validate schema<br/>- Check fields<br/>- Call Service"]
        C2["ChatController<br/>sendMessage(req, res)<br/>- Validate message<br/>- Sanitize input<br/>- Rate limiting<br/>- Call Service"]
        C3["LocationController<br/>getLocations(req, res)<br/>- Parse query<br/>- Apply filters<br/>- Pagination<br/>- Return results"]
        C4["AdminController<br/>login(req, res)<br/>- Hash password check<br/>- Generate JWT<br/>- Return token"]
    end

    subgraph Middleware["Middleware - X·ª≠ L√Ω Ngang"]
        M1["authMiddleware<br/>- Ki·ªÉm tra JWT token<br/>- X√°c th·ª±c Admin"]
        M2["errorHandler<br/>- B·∫Øt l·ªói<br/>- Format response"]
        M3["logger<br/>- Ghi log request<br/>- Ghi log response"]
    end

    subgraph Validation["Validation Layer"]
        V1["validateItineraryInput()<br/>- Check required fields<br/>- Validate budget<br/>- Check dates"]
        V2["validateChatInput()<br/>- Message not empty<br/>- Max length 1000"]
        V3["validateAdminLogin()<br/>- Username format<br/>- Password strength"]
    end

    R1 --> M1
    R2 --> M1
    R3 --> M1
    R4 --> M1

    M1 --> M3
    M3 --> C1
    M3 --> C2
    M3 --> C3
    M3 --> C4

    C1 --> V1
    C2 --> V2
    C4 --> V3

    V1 -->|Valid| Service["üì§ G·ªçi Service Layer"]
    V2 -->|Valid| Service
    V3 -->|Valid| Service

    V1 -->|Invalid| Error["‚ùå Tr·∫£ HTTP 400"]
    V2 -->|Invalid| Error
    V3 -->|Invalid| Error
```

**Quy tr√¨nh x·ª≠ l√Ω request:**

| B∆∞·ªõc | Th√†nh Ph·∫ßn | C√¥ng Vi·ªác               | K·∫øt Qu·∫£               |
| ---- | ---------- | ----------------------- | --------------------- |
| 1    | Route      | Kh·ªõp URL v·ªõi endpoint   | Chuy·ªÉn ƒë·∫øn Controller |
| 2    | Middleware | Ki·ªÉm tra JWT, ghi log   | Cho ph√©p ho·∫∑c t·ª´ ch·ªëi |
| 3    | Controller | Parse request, validate | Chu·∫©n b·ªã d·ªØ li·ªáu      |
| 4    | Validation | Ki·ªÉm tra schema, format | Valid ho·∫∑c Error 400  |
| 5    | Service    | X·ª≠ l√Ω logic nghi·ªáp v·ª•   | K·∫øt qu·∫£ x·ª≠ l√Ω         |
| 6    | Response   | Tr·∫£ v·ªÅ client           | HTTP 200/400/500      |

---

### 5.4. Chi Ti·∫øt L·ªõp D·ªãch V·ª• (Service Layer)

L·ªõp Service ch·ª©a to√†n b·ªô logic nghi·ªáp v·ª•, x·ª≠ l√Ω d·ªØ li·ªáu ph·ª©c t·∫°p, g·ªçi API b√™n ngo√†i, v√† ƒëi·ªÅu ph·ªëi database.

```mermaid
graph TB
    subgraph ItineraryService["ItineraryService - T·∫°o L·ªãch Tr√¨nh"]
        IS1["generateItinerary(input)<br/>B∆∞·ªõc 1: Validate ng√¢n s√°ch<br/>B∆∞·ªõc 2: Ch·ªçn l∆∞u tr√∫<br/>B∆∞·ªõc 3: Ph√¢n b·ªï ng√¢n s√°ch/ng√†y<br/>B∆∞·ªõc 4: T·∫°o l·ªãch t·ª´ng ng√†y"]
        IS2["generateDaySchedule(day, budget)<br/>7 pha x·ª≠ l√Ω:<br/>‚ë† Filter h·ª£p l·ªá<br/>‚ë° Lo·∫°i tr·ª´<br/>‚ë¢ S·∫Øp x·∫øp<br/>‚ë£ ƒê√≥ng g√≥i<br/>‚ë§ T·ªëi ∆∞u<br/>‚ë• X√°c th·ª±c"]
        IS3["validateBudgetFeasibility()<br/>- T√≠nh chi ph√≠ t·ªëi thi·ªÉu<br/>- Ki·ªÉm tra kh·∫£ nƒÉng t√†i ch√≠nh"]
    end

    subgraph ChatbotService["ChatbotService - X·ª≠ L√Ω Chat"]
        CS1["processChatMessage(message)<br/>B∆∞·ªõc 1: Ph√¢n t√≠ch intent<br/>B∆∞·ªõc 2: Truy v·∫•n KB<br/>B∆∞·ªõc 3: G·ªçi Gemini"]
        CS2["extractIntent(text)<br/>- NLP x√°c ƒë·ªãnh √Ω ƒë·ªãnh<br/>- Match patterns"]
        CS3["callGeminiAPI(message)<br/>- G·ª≠i request ƒë·∫øn AI<br/>- Parse response"]
        CS4["logChatMessage(msg, response)<br/>- L∆∞u v√†o CHAT_LOG"]
    end

    subgraph LocationService["LocationService - Qu·∫£n L√Ω ƒê·ªãa ƒêi·ªÉm"]
        LS1["getAllLocations(filters)<br/>- Query DB<br/>- Apply filters<br/>- Return list"]
        LS2["searchLocations(keyword)<br/>- T√¨m ki·∫øm theo t√™n<br/>- Match tags"]
        LS3["getLocationById(id)<br/>- Query DB<br/>- Return chi ti·∫øt"]
    end

    subgraph AdminService["AdminService - Qu·∫£n Tr·ªã Vi√™n"]
        AS1["authenticate(username, pwd)<br/>- Hash password<br/>- Compare<br/>- Generate JWT"]
        AS2["updateLocation(id, data)<br/>- Validate input<br/>- Update DB<br/>- Log audit"]
        AS3["manageKnowledge(action)<br/>- CRUD Q&A<br/>- Train patterns"]
    end

    subgraph External["G·ªçi API B√™n Ngo√†i"]
        EX1["Google Gemini API<br/>- NLP processing<br/>- Response generation"]
        EX2["Google Maps API<br/>- Distance Matrix<br/>- Route optimization"]
    end

    subgraph Utils["Utility Functions"]
        U1["calculateDistance()<br/>- G·ªçi Maps API<br/>- Parse result"]
        U2["formatResponse()<br/>- JSON structure<br/>- Add metadata"]
        U3["optimizeSchedule()<br/>- TSP solving<br/>- Greedy algorithm"]
    end

    IS1 --> IS2
    IS1 --> IS3
    IS2 --> Utils

    CS1 --> CS2
    CS2 --> CS3
    CS3 --> External
    CS3 --> CS4

    LS1 --> LS2
    LS2 --> LS3

    AS1 --> AS2
    AS2 --> AS3

    Utils --> EX1
    Utils --> EX2

    IS1 -.->|Tr·∫£ k·∫øt qu·∫£| Response["üì§ Tr·∫£ v·ªÅ Controller"]
    CS1 -.->|Tr·∫£ k·∫øt qu·∫£| Response
    LS1 -.->|Tr·∫£ k·∫øt qu·∫£| Response
    AS1 -.->|Tr·∫£ k·∫øt qu·∫£| Response
```

**Tr√°ch nhi·ªám t·ª´ng Service:**

| Service              | Ch·ª©c NƒÉng Ch√≠nh                        | G·ªçi API    | G·ªçi Database        |
| -------------------- | -------------------------------------- | ---------- | ------------------- |
| **ItineraryService** | T·∫°o l·ªãch tr√¨nh t·ª± ƒë·ªông, t·ªëi ∆∞u chi ph√≠ | Maps API   | LOCATION, ITINERARY |
| **ChatbotService**   | X·ª≠ l√Ω tin nh·∫Øn, tr·∫£ l·ªùi c√¢u h·ªèi        | Gemini API | CHAT_LOG, KNOWLEDGE |
| **LocationService**  | T√¨m ki·∫øm, l·ªçc, tr·∫£ v·ªÅ ƒë·ªãa ƒëi·ªÉm         | Kh√¥ng      | LOCATION            |
| **AdminService**     | X√°c th·ª±c, qu·∫£n l√Ω d·ªØ li·ªáu              | Kh√¥ng      | ADMIN, KNOWLEDGE    |

---

### 5.5. Chi Ti·∫øt L·ªõp Truy C·∫≠p D·ªØ Li·ªáu (Data Access Layer)

L·ªõp n√†y th√¥ng qua **Prisma ORM** ƒë·ªÉ th·ª±c hi·ªán CRUD operations v·ªõi database.

```mermaid
graph TB
    subgraph Services["Service Layer<br/>G·ªçi query"]
        S1["ItineraryService.query()"]
        S2["LocationService.query()"]
        S3["ChatbotService.query()"]
        S4["AdminService.query()"]
    end

    subgraph Prisma["Prisma ORM - Data Access Layer"]
        P1["prisma.location.findMany()<br/>prisma.location.findUnique()"]
        P2["prisma.itinerary.create()<br/>prisma.itinerary.update()"]
        P3["prisma.chatLog.create()"]
        P4["prisma.admin.findUnique()"]
        P5["prisma.knowledge.findMany()"]
    end

    subgraph Queries["Query Methods"]
        Q1["SELECT (Read)<br/>- findMany()<br/>- findUnique()<br/>- findFirst()"]
        Q2["INSERT (Create)<br/>- create()<br/>- createMany()"]
        Q3["UPDATE<br/>- update()<br/>- updateMany()"]
        Q4["DELETE<br/>- delete()<br/>- deleteMany()"]
    end

    subgraph Database["Database Layer"]
        DB1["Table: LOCATION<br/>- id, name, address<br/>- lat, lng, type<br/>- ticket, food, extra"]
        DB2["Table: ITINERARY<br/>- id, name, startDate<br/>- endDate, budget<br/>- preferences"]
        DB3["Table: ADMIN<br/>- id, username<br/>- passwordHash, email"]
        DB4["Table: CHAT_LOG<br/>- id, sessionId<br/>- userMessage, botResponse"]
        DB5["Table: KNOWLEDGE<br/>- id, question<br/>- answer, keywords"]
    end

    S1 --> P1
    S1 --> P2
    S2 --> P1
    S3 --> P3
    S4 --> P4
    S4 --> P5

    P1 --> Q1
    P2 --> Q2
    P2 --> Q3
    P3 --> Q2
    P4 --> Q1
    P5 --> Q1

    Q1 --> DB1
    Q1 --> DB2
    Q1 --> DB3
    Q2 --> DB1
    Q2 --> DB2
    Q2 --> DB4
    Q3 --> DB1
    Q4 --> DB1

    DB1 -.->|SQL Execute| DatabaseEngine["üóÑÔ∏è PostgreSQL / SQLite"]
```

**C√°c ho·∫°t ƒë·ªông CRUD qua Prisma:**

| Ho·∫°t ƒê·ªông  | Prisma Method | B·∫£ng      | V√≠ D·ª•                                                           |
| ---------- | ------------- | --------- | --------------------------------------------------------------- |
| **Read**   | findMany()    | LOCATION  | `prisma.location.findMany({ where: { type: "restaurant" } })`   |
| **Read**   | findUnique()  | ADMIN     | `prisma.admin.findUnique({ where: { username: "admin1" } })`    |
| **Create** | create()      | ITINERARY | `prisma.itinerary.create({ data: { name, budget, dates } })`    |
| **Create** | create()      | CHAT_LOG  | `prisma.chatLog.create({ data: { userMessage, botResponse } })` |
| **Update** | update()      | LOCATION  | `prisma.location.update({ where: { id }, data: { name } })`     |
| **Delete** | delete()      | LOCATION  | `prisma.location.delete({ where: { id } })`                     |

**M·ªëi Quan H·ªá D·ªØ Li·ªáu:**

```
ADMIN
  ‚îú‚îÄ 1-N ‚Üí KNOWLEDGE (qu·∫£n l√Ω Q&A)
  ‚îú‚îÄ 1-N ‚Üí LOCATION (ch·ªânh s·ª≠a ƒë·ªãa ƒëi·ªÉm)
  ‚îî‚îÄ 1-N ‚Üí ACCESS_LOG (l·ªãch s·ª≠ truy c·∫≠p)

LOCATION
  ‚îú‚îÄ 1-N ‚Üí CHAT_LOG (ƒë∆∞·ª£c ƒë·ªÅ c·∫≠p)
  ‚îî‚îÄ N-N ‚Üí ITINERARY (ch·ª©a c√°c ƒë·ªãa ƒëi·ªÉm)

ITINERARY
  ‚îú‚îÄ N-N ‚Üí LOCATION
  ‚îî‚îÄ 1-N ‚Üí ACCESS_LOG

CHAT_LOG (Logging)
  ‚îî‚îÄ 1-N ‚Üí SESSION (l·ªãch s·ª≠ tr√≤ chuy·ªán)
```

---

```javascript
ItineraryService.generateItinerary()
  ‚îú‚îÄ validateBudgetFeasibility()
  ‚îú‚îÄ selectAccommodation()
  ‚îú‚îÄ allocateBudgetPerDay()
  ‚îú‚îÄ generateDayScheduleStrict() [7 phases]
  ‚îî‚îÄ formatOutput()

ChatbotService.processChatMessage()
  ‚îú‚îÄ extractIntent()
  ‚îú‚îÄ queryKnowledgeBase()
  ‚îú‚îÄ callGeminiAPI()
  ‚îú‚îÄ executeAction()
  ‚îî‚îÄ logChatMessage()

LocationService
  ‚îú‚îÄ getAllLocations()
  ‚îú‚îÄ searchLocations()
  ‚îî‚îÄ updateLocation()

AdminService
  ‚îú‚îÄ authenticate()
  ‚îú‚îÄ manageChatLogs()
  ‚îî‚îÄ manageLocations()
```

---

## 6. LU·ªíNG HO·∫†T ƒê·ªòNG CH√çNH

### 6.1. Lu·ªìng: T·∫°o L·ªãch Tr√¨nh (Complete Flow)

Quy tr√¨nh ho√†n ch·ªânh t·ª´ khi kh√°ch du l·ªãch nh·∫≠p y√™u c·∫ßu cho ƒë·∫øn khi nh·∫≠n l·∫°ich∆∞∆°ng tr√¨nh:

```mermaid
sequenceDiagram
    actor User as Kh√°ch Du L·ªãch
    participant Frontend as Frontend<br/>React SPA
    participant Backend as Backend<br/>Express API
    participant Service as ItineraryService
    participant Validator as Validator
    participant DB as Database<br/>Prisma

    User->>Frontend: 1. Nh·∫≠p y√™u c·∫ßu l·ªãch tr√¨nh<br/>(Ng√¢n s√°ch, Ng√†y, S·ªü th√≠ch)

    Frontend->>Frontend: 2. Ki·ªÉm tra d·ªØ li·ªáu ph√≠a client

    alt D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá
        Frontend-->>User: Th√¥ng b√°o l·ªói
    else D·ªØ li·ªáu h·ª£p l·ªá
        Frontend->>Backend: 3. G·ª≠i POST /api/itinerary/generate<br/>JSON payload

        Backend->>Backend: 4. Ph√¢n t√≠ch v√† x√°c th·ª±c input
        Backend->>Service: 5. G·ªçi generateItinerary()

        Service->>Validator: 6. Ki·ªÉm tra ng√¢n s√°ch kh·∫£ thi
        Validator-->>Service: Ng√¢n s√°ch OK

        Service->>DB: 7. Truy v·∫•n kh√°ch s·∫°n ph√π h·ª£p
        DB-->>Service: D·ªØ li·ªáu kh√°ch s·∫°n

        Service->>DB: 8. L·∫•y to√†n b·ªô d·ªØ li·ªáu ƒë·ªãa ƒëi·ªÉm
        DB-->>Service: 120+ ƒë·ªãa ƒëi·ªÉm

        loop Cho m·ªói ng√†y
            Service->>Service: 9. L·∫≠p l·ªãch ng√†y v·ªõi 7 pha
            Service->>Validator: 10. L·ªçc ƒë·ªãa ƒëi·ªÉm h·ª£p l·ªá
            Validator->>Validator: 11. Ki·ªÉm tra ƒëi·ªÅu ki·ªán<br/>- Gi·ªù m·ªü c·ª≠a<br/>- Ng√¢n s√°ch<br/>- Lo·∫°i ƒë·ªãa ƒëi·ªÉm
            Validator-->>Service: Danh s√°ch ƒë·ªãa ƒëi·ªÉm h·ª£p l·ªá
            Service->>Service: 12. S·∫Øp x·∫øp theo s·ªü th√≠ch<br/>v√† kho·∫£ng c√°ch
        end

        Service->>Service: 13. ƒê·ªãnh d·∫°ng k·∫øt qu·∫£ JSON
        Service-->>Backend: D·ªØ li·ªáu l·ªãch tr√¨nh ho√†n ch·ªânh

        Backend-->>Frontend: 14. Tr·∫£ v·ªÅ HTTP 200 OK

        Frontend->>Frontend: 15. Ph√¢n t√≠ch d·ªØ li·ªáu<br/>v√† l∆∞u v√†o localStorage
        Frontend->>Frontend: 16. Hi·ªÉn th·ªã trang k·∫øt qu·∫£
        Frontend-->>User: L·ªãch tr√¨nh ho√†n ch·ªânh
    end
```

### 6.2. Lu·ªìng: Chatbot Interaction

Quy tr√¨nh khi kh√°ch du l·ªãch chat v·ªõi tr·ª£ l√Ω AI ƒë·ªÉ t∆∞ v·∫•n ho·∫∑c ch·ªânh s·ª≠a l·ªãch:

```mermaid
sequenceDiagram
    actor User as Kh√°ch Du L·ªãch
    participant Frontend as Frontend<br/>React
    participant API as Backend<br/>Express
    participant Service as ChatbotService
    participant DB as Database
    participant Gemini as Google Gemini

    User->>Frontend: 1. G√µ tin nh·∫Øn v√† g·ª≠i

    Frontend->>API: 2. G·ª≠i POST /api/chat/message<br/>K√®m n·ªôi dung chat v√† ID session

    API->>Service: 3. X·ª≠ l√Ω tin nh·∫Øn chat

    Service->>Service: 4. Ph√¢n t√≠ch √Ω ƒë·ªãnh<br/>D·ª±a tr√™n t·ª´ kh√≥a

    Service->>DB: 5. T√¨m ki·∫øm trong m·∫´u Q&A<br/>Matching pattern

    DB-->>Service: D·ªØ li·ªáu m·∫´u t√¨m th·∫•y

    alt √ù ƒë·ªãnh = "Thay ƒë·ªïi ƒë·ªãa ƒëi·ªÉm"
        Service->>Service: 6a. T√¨m th·ªùi gian slot tr·ªëng
        Service->>DB: 6b. L·∫•y danh s√°ch ƒë·ªãa ƒëi·ªÉm thay th·∫ø
        Service-->>API: C·∫≠p nh·∫≠t l·ªãch tr√¨nh
    else √ù ƒë·ªãnh = "Th√™m ƒë·ªãa ƒëi·ªÉm"
        Service->>DB: 6c. L·∫•y ƒë·ªãa ƒëi·ªÉm ·ª©ng c·ª≠
        Service->>Service: 6d. T·ªëi ∆∞u v·ªã tr√≠ ch√®n
        Service-->>API: Th√™m v√†o l·ªãch
    else √ù ƒë·ªãnh kh√°c
        Service->>Gemini: 6e. G·ªçi Google Gemini<br/>K√®m prompt v√† context
        Gemini-->>Service: Ph·∫£n h·ªìi ƒë∆∞·ª£c t·∫°o
        Service->>DB: 6f. L∆∞u l·∫°i cu·ªôc tr√≤ chuy·ªán
        Service-->>API: Tr·∫£ v·ªÅ ph·∫£n h·ªìi bot
    end

    API-->>Frontend: 7. Tr·∫£ v·ªÅ HTTP 200<br/>K√®m n·ªôi dung tr·∫£ l·ªùi

    Frontend->>Frontend: 8. Ph√¢n t√≠ch v√† hi·ªÉn th·ªã<br/>Tin nh·∫Øn chat

    Frontend-->>User: 9. Hi·ªÉn th·ªã ph·∫£n h·ªìi t·ª´ AI
```

---

## 7. C√îNG NGH·ªÜ V√Ä STACK

### 7.1. Frontend Stack

| Th√†nh ph·∫ßn      | C√¥ng ngh·ªá    | Phi√™n b·∫£n |
| --------------- | ------------ | --------- |
| Framework       | React        | 18.x      |
| Build Tool      | Vite         | 5.x       |
| Routing         | React Router | 6.x       |
| Styling         | Tailwind CSS | 3.x       |
| HTTP            | Fetch API    | Native    |
| State           | React Hooks  | Native    |
| Package Manager | npm          | 10.x      |

### 7.2. Backend Stack

| Th√†nh ph·∫ßn      | C√¥ng ngh·ªá     | Phi√™n b·∫£n |
| --------------- | ------------- | --------- |
| Runtime         | Node.js       | 18+LTS    |
| Framework       | Express.js    | 4.x       |
| ORM             | Prisma        | 5.x       |
| DB (Dev)        | SQLite        | 3.x       |
| DB (Prod)       | PostgreSQL    | 14+       |
| External AI     | Google Gemini | v1        |
| External API    | Google Maps   | v3        |
| Package Manager | npm           | 10.x      |

### 7.3. DevOps & Deployment

| Th√†nh ph·∫ßn      | C√¥ng Ngh·ªá              | Ghi Ch√∫               |
| --------------- | ---------------------- | --------------------- |
| Version Control | Git + GitHub           | Repository management |
| Environment     | .env files             | Configuration         |
| DB Migration    | Prisma Migrate         | Schema versioning     |
| Logging         | Console + DB           | Audit trail           |
| Error Handling  | Try-Catch + Middleware | Exception management  |

---

## 8. C∆† CH·∫æ B·∫¢O M·∫¨T

### 8.1. X√°c Th·ª±c (Authentication)

**M·ª•c ti√™u:** Ch·ªâ admin ƒë∆∞·ª£c ph√©p truy c·∫≠p ch·ª©c nƒÉng qu·∫£n tr·ªã

**C∆° ch·∫ø:**

- Admin ƒëƒÉng nh·∫≠p: username + password
- Password m√£ h√≥a bcrypt (one-way function)
- C·∫•p session token / JWT sau x√°c th·ª±c
- Token g·ª≠i trong header `Authorization: Bearer <token>`
- M·ªçi request qu·∫£n tr·ªã ph·∫£i c√≥ token h·ª£p l·ªá

**Implementation:**

```javascript
POST /api/admin/login
{username, password}

Backend:
‚Üí Query database: SELECT * WHERE username = ?
‚Üí Compare: bcrypt.compare(input, hash)
‚Üí If match: jwt.sign({adminId}, SECRET_KEY, {expiresIn: '7d'})
‚Üí Return: {token}
```

### 8.2. Ph√¢n Quy·ªÅn (Authorization)

**Roles:**

- **admin:** To√†n quy·ªÅn
- **guest:** Ch·ªâ t·∫°o l·ªãch, chat (kh√¥ng qu·∫£n tr·ªã)

**Middleware ki·ªÉm tra:**

```javascript
function authAdminMiddleware(req, res, next) {
  const token = req.headers.authorization?.split(" ")[1];
  if (!token) return res.status(401).json({ error: "No token" });

  try {
    const decoded = jwt.verify(token, SECRET_KEY);
    req.adminId = decoded.adminId;
    next();
  } catch {
    res.status(401).json({ error: "Invalid token" });
  }
}
```

### 8.3. B·∫£o V·ªá D·ªØ Li·ªáu

**SQL Injection:** S·ª≠ d·ª•ng Prisma ORM (parameterized queries)

**CORS:** Ch·ªâ accept requests t·ª´ trusted origin

```javascript
app.use(
  cors({
    origin: process.env.FRONTEND_URL,
    credentials: true,
  })
);
```

**Input Validation:** Validate t·∫•t c·∫£ input tr∆∞·ªõc x·ª≠ l√Ω

```javascript
const errors = validateUserRequest(req.body);
if (errors.length > 0) {
  return res.status(400).json({ errors });
}
```

**HTTPS in Production:** T·∫•t c·∫£ traffic s·ª≠ d·ª•ng SSL/TLS

### 8.4. Logging & Audit Trail

```javascript
// Access Log
INSERT INTO AccessLog (ip, endpoint, method, statusCode...)

// Chat Log
INSERT INTO ChatLog (userMessage, botResponse, intent...)

// Admin Actions
INSERT INTO AdminActionLog (adminId, action, affectedRecords...)
```

---

## 9. PH√ÇN T√çCH HI·ªÜU NƒÇNG

### 9.1. ƒê·ªô Ph·ª©c T·∫°p (Complexity Analysis)

| Operation             | Time Complexity | Ghi Ch√∫                  |
| --------------------- | --------------- | ------------------------ |
| Fetch all locations   | O(n)            | n = 120                  |
| Generate itinerary    | O(n √ó d √ó p)    | d=days, p=phases         |
| Search location       | O(n log n)      | Binary search            |
| Optimize sequence     | O(n log n)      | Clustering               |
| Generate day schedule | O(m √ó k)        | m=7 phases, k=candidates |

**∆Ø·ªõc t√≠nh:** T·∫°o l·ªãch 3 ng√†y ‚âà 50-150ms

### 9.2. T·ªëi ∆Øu H√≥a

**Caching:**

- Cache danh s√°ch locations (Memory)
- Cache Knowledge Base patterns
- Invalidate on update

**Database Indexing:**

```sql
CREATE INDEX idx_location_type ON Location(type);
CREATE INDEX idx_location_area ON Location(area);
CREATE INDEX idx_admin_username ON Admin(username);
CREATE INDEX idx_log_created ON AccessLog(createdAt);
```

---

## K·∫æT LU·∫¨N

Ki·∫øn tr√∫c **DanangTravel-AI** ƒë∆∞·ª£c thi·∫øt k·∫ø theo c√°c nguy√™n t·∫Øc SOLID:

- **Separation of Concerns:** T·∫ßng r√µ r√†ng (Presentation, Business, Data)
- **Single Responsibility:** M·ªói service l√†m m·ªôt vi·ªác
- **DRY:** Lo·∫°i b·ªè tr√πng l·∫∑p code
- **Scalable:** H·ªó tr·ª£ t·ªëi thi·ªÉu 1000+ ng∆∞·ªùi d√πng ƒë·ªìng th·ªùi
- **Secure:** B·∫£o v·ªá d·ªØ li·ªáu, x√°c th·ª±c Admin, ph√¢n quy·ªÅn
- **Maintainable:** D·ªÖ hi·ªÉu, d·ªÖ m·ªü r·ªông

H·ªá th·ªëng n√†y ph√π h·ª£p cho m·ª•c ƒë√≠ch h·ªçc thu·∫≠t, th·ª±c ti·ªÖn, v√† c√≥ ti·ªÅm nƒÉng ph√°t tri·ªÉn sang Microservices trong t∆∞∆°ng lai.

---

**T√†i li·ªáu ƒë∆∞·ª£c chu·∫©n b·ªã theo ti√™u chu·∫©n h·ªçc thu·∫≠t cho m·ª•c ƒë√≠ch ƒë√°nh gi√° ch·∫•t l∆∞·ª£ng d·ª± √°n**
